(()=>{var e={n:t=>{var o=t&&t.__esModule?()=>t.default:()=>t;return e.d(o,{a:o}),o},d:(t,o)=>{for(var r in o)e.o(o,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:o[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};(()=>{"use strict";const t=flarum.reg.get("core","common/app");e.n(t)().initializers.add("ecss11-money-history-common",(()=>{console.log("[ecss11/flarum-ext-money-history] Hello, forum and admin!")}));const o=flarum.reg.get("core","forum/app");var r=e.n(o);const s=flarum.reg.get("core","common/extend"),n=flarum.reg.get("core","forum/components/UserPage");var a=e.n(n);const i=flarum.reg.get("core","common/components/LinkButton");var l=e.n(i);const u=flarum.reg.get("core","Component");var y=e.n(u);const d=flarum.reg.get("core","app");var c=e.n(d);const p=flarum.reg.get("core","components/LoadingIndicator");var h=e.n(p);const g=flarum.reg.get("core","components/Button");var f=e.n(g);const v=flarum.reg.get("core","components/Link");var b=e.n(v);const M=flarum.reg.get("core","helpers/avatar");var x=e.n(M);const H=flarum.reg.get("core","helpers/username");var R=e.n(H);class O extends(y()){view(){const{userMoneyHistory:e}=this.attrs,t=e.changeTime(),o=e.money(),r=e.sourceDesc(),s=e.id(),n=(e.user(),e.createUser()),a=e.balanceMoney(),i=e.lastMoney(),l=app.translator.trans("D"===e.type()?"mattoid-money-history.forum.record.money-out":"mattoid-money-history.forum.record.money-in"),u="D"===e.type()?"color:red":"color:green";return m("div",{className:"transferHistoryContainer"},m("div",{style:"padding-top: 5px;"},m("b",null,app.translator.trans("mattoid-money-history.forum.record.money-list-type"),": "),m("span",{style:u},l)," | ",m("b",null,app.translator.trans("mattoid-money-history.forum.record.money-list-assign-at"),": "),t),m("div",{style:"padding-top: 5px;"},m("b",null,app.translator.trans("mattoid-money-history.forum.record.money-list-id"),": "),s," | ",m("b",null,app.translator.trans("mattoid-money-history.forum.record.money-list-from-user"),": "),m(b(),{href:"#",className:"moneyHistoryUser",style:"color:var(--heading-color)"},x()(n)," ",R()(n))," | ",m("b",null,app.translator.trans("mattoid-money-history.forum.record.money-list-amount"),": "),o," | ",m("b",null,app.translator.trans("mattoid-money-history.forum.record.money-list-balance"),": "),a," → ",i," | ",m("span",null,m("b",null,app.translator.trans("mattoid-money-history.forum.record.money-list-transfer-notes"),": "),r)))}}flarum.reg.add("ecss11-money-history","forum/components/MoneyHistoryListItem",O);class U extends(y()){oninit(e){super.oninit(e),this.loading=!0,this.moreResults=!1,this.userMoneyHistory=[],this.user=this.attrs.params.user,this.loadResults()}view(){let e;return this.loading&&(e=h().component({size:"large"})),m("div",null,m("div",{style:"padding-bottom:10px; font-size: 24px;font-weight: bold;"},c().translator.trans("mattoid-money-history.forum.title")),m("ul",{style:"margin: 0;padding: 0;list-style-type: none;position: relative;"},this.userMoneyHistory.map((e=>m("li",{style:"padding-top:5px",key:e.id,"data-id":e.id},O.component({userMoneyHistory:e}))))),!this.loading&&0===this.userMoneyHistory.length&&m("div",null,m("div",{style:"font-size:1.4em;color: var(--muted-more-color);text-align: center;height: 300px;line-height: 100px;"},c().translator.trans("mattoid-money-history.forum.list-empty"))),this.hasMoreResults()&&m("div",{style:"text-align:center;padding:20px"},m(f(),{className:"Button Button--primary",disabled:this.loading,loading:this.loading,onclick:()=>this.loadMore()},c().translator.trans("mattoid-money-history.forum.money-list-load-more"))))}loadMore(){this.loading=!0,this.loadResults(this.userMoneyHistory.length)}parseResults(e){return this.moreResults=!!e.payload.links&&!!e.payload.links.next,[].push.apply(this.userMoneyHistory,e),this.loading=!1,m.redraw(),e}hasMoreResults(){return this.moreResults}loadResults(e){void 0===e&&(e=0);let t="/users/"+this.user.id()+"/money/history";return c().store.find(t,{filter:{user:this.user.id()},page:{offset:e}}).catch((()=>{})).then(this.parseResults.bind(this))}}flarum.reg.add("ecss11-money-history","forum/components/MoneyHistoryList",U);class k extends(a()){oninit(e){super.oninit(e),this.loadUser(m.route.param("username"))}content(){return m("div",{className:"Post-body"},U.component({params:{user:this.user}}))}}flarum.reg.add("ecss11-money-history","forum/components/MoneyHistoryPage",k);const _=flarum.reg.get("core","common/Model");var w=e.n(_);class z extends(w()){}Object.assign(z.prototype,{type:w().attribute("type"),money:w().attribute("money"),sourceDesc:w().attribute("source_desc"),changeTime:w().attribute("change_time"),balanceMoney:w().attribute("balance_money"),lastMoney:w().attribute("last_money"),user:w().hasOne("user"),createUser:w().hasOne("createUser")}),flarum.reg.add("ecss11-money-history","forum/models/UserMoneyHistory",z),r().initializers.add("flarum-ext-money-history",(()=>{r().store.models.userMoneyHistory=z,r().routes.userMoneyHistory={path:"/u/:username/money/history",component:k},(0,s.extend)(a().prototype,"navItems",(function(e){null!==r().session.user&&(r().session.user.id()===this.user.id()||this.user&&this.user.attribute("canQueryOthersMoneyHistory"))&&e.add("userMoneyHistory",l().component({href:r().route("userMoneyHistory",{username:this.user.slug()}),icon:"fas fa-money-bill"},r().translator.trans("mattoid-money-history.forum.nav")))}))}))})(),module.exports={}})();
//# sourceMappingURL=forum.js.map